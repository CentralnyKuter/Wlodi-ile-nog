<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Wizualizacja sceny z panelami (osobne nogi dla głównej i uzupełnień) – DARK THEME</title>
  <style>
    /* Tło całej strony: ciemne */
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      background-color: #121212;
      color: #FFFFFF;
    }

    /* Kontener sceny – rozmiar wg wprowadzonych wymiarów (1 m = 50px) */
    #stage {
      position: relative;
      margin-top: 20px;
      background-color: #1E1E1E;
      border: 1px solid #444444;
    }

    .panel {
      position: absolute;
      border: 1px solid white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0px;
      color: #FFFFFF;
      box-sizing: border-box;
    }

    /* Panele główne */
    .primary {
      background-color: #4CAF50;
    }
    /* Panele uzupełniające (obrócone o 90°) */
    .rotated {
      background-color: #FF5722;
    }
    /* Panele 1×1 */
    .small {
      background-color: #3F51B5;
    }

    /* Wygląd nóg */
    .leg {
      position: absolute;
      width: 8px;
      height: 8px;
      border-radius: 50%;
	border: 1px solid white;
      background-color: grey;
      pointer-events: none;

    }

    /* Formy i etykiety w ciemnym stylu */
    form label {
      display: block;
      margin-bottom: 10px;
      color: #FFFFFF;
    }

    form input[type="number"] {
      background-color: #2A2A2A;
      color: #FFFFFF;
      border: 1px solid #555555;
      margin-left: 5px;
      width: 60px;
    }

    form input[type="radio"] {
      margin-left: 15px;
    }

    form button {
      margin-top: 10px;
      padding: 6px 12px;
      border: none;
      cursor: pointer;
      background-color: #0066CC;
      color: #FFFFFF;
      font-weight: bold;
    }

    form button:hover {
      background-color: #005BB5;
    }

    /* Sekcja podsumowania */
    #summary {
      margin-top: 20px;
      font-weight: ;
      white-space: pre;
      color: #FFFFFF;
    }
  </style>
</head>
<body>
  <h2>Włodi, ile nóg?</h2>
  <form id="stageForm">
    <label>
      Szerokość sceny (m): 
      <input type="number" id="sceneWidth" min="1" value="9">
    </label>
    <label>
      Wysokość sceny (m): 
      <input type="number" id="sceneHeight" min="1" value="7">
    </label>
    <label>
      Orientacja paneli:
    </label>
    <label>
      <input type="radio" name="orientation" value="wzdluż" checked> Normalnie
    </label>
    <label>
      <input type="radio" name="orientation" value="wpoprzek"> Jak lewus
    </label>
    <button type="button" onclick="drawStage()">Generuj podest</button>
  </form>

  <div id="stage"></div>
  <div id="summary"></div>

  <script>
    // Define drawStage in the global scope
    window.drawStage = function drawStage() {
      // Pobranie wymiarów sceny oraz orientacji
      const sceneWidth = parseInt(document.getElementById('sceneWidth').value);
      const sceneHeight = parseInt(document.getElementById('sceneHeight').value);
      const orientation = document.querySelector('input[name="orientation"]:checked').value;

      // Skala: 1 m = 50 px
      const scale = 50;

      // Czyścimy zawartość sceny
      const stageDiv = document.getElementById('stage');
      stageDiv.innerHTML = '';
      stageDiv.style.width = (sceneWidth * scale) + 'px';
      stageDiv.style.height = (sceneHeight * scale) + 'px';

      // Określamy wymiary paneli głównych oraz obróconych
      let primaryPanelWidth, primaryPanelHeight;
      let rotatedPanelWidth, rotatedPanelHeight;
      let primaryCols, primaryRows;

      if (orientation === 'wzdluż') {
        // Główne panele: 2×1 m
        primaryPanelWidth = 2;
        primaryPanelHeight = 1;
        // Uzupełniające (obrócone o 90°): 1×2 m
        rotatedPanelWidth = 1;
        rotatedPanelHeight = 2;
        
        primaryCols = Math.floor(sceneWidth / primaryPanelWidth);
        primaryRows = Math.floor(sceneHeight / primaryPanelHeight);
      } else {
        // Główne panele: 1×2 m
        primaryPanelWidth = 1;
        primaryPanelHeight = 2;
        // Uzupełniające: 2×1 m
        rotatedPanelWidth = 2;
        rotatedPanelHeight = 1;
        
        primaryCols = Math.floor(sceneWidth / primaryPanelWidth);
        primaryRows = Math.floor(sceneHeight / primaryPanelHeight);
      }

      // Dwa zbiory na rogi: 
      // 1) dla głównej sceny, 2) dla paneli dobudowanych
      const usedCornersMain = new Set();
      const usedCornersAddons = new Set();

      /**
       * Dodaje "nogę" w logicznym rogu (cornerX, cornerY) na głównej scenie.
       * cornerType: 'topLeft','topRight','bottomLeft','bottomRight'
       */
      function addLegMain(cornerX, cornerY, cornerType) {
        const key = `${cornerX},${cornerY}`;
        if (usedCornersMain.has(key)) {
          return;
        }
        usedCornersMain.add(key);

        const leg = document.createElement('div');
        leg.classList.add('leg');

        let legX = cornerX * scale;
        let legY = cornerY * scale;

        // Przesunięcie nogi do wewnątrz (px)
        const offset = 8;

        switch (cornerType) {
          case 'topLeft':
            legX += offset;
            legY += offset;
            break;
          case 'topRight':
            legX -= offset;
            legY += offset;
            break;
          case 'bottomLeft':
            legX += offset;
            legY -= offset;
            break;
          case 'bottomRight':
            legX -= offset;
            legY -= offset;
            break;
        }

        leg.style.left = (legX - 4) + 'px';
        leg.style.top = (legY - 4) + 'px';
        stageDiv.appendChild(leg);
      }

      /**
       * Dodaje "nogę" w logicznym rogu (cornerX, cornerY) w dobudowanej scenie.
       */
      function addLegAddon(cornerX, cornerY, cornerType) {
        const key = `${cornerX},${cornerY}`;
        if (usedCornersAddons.has(key)) {
          return;
        }
        usedCornersAddons.add(key);

        const leg = document.createElement('div');
        leg.classList.add('leg');

        let legX = cornerX * scale;
        let legY = cornerY * scale;

        // To samo przesunięcie
        const offset = 8;

        switch (cornerType) {
          case 'topLeft':
            legX += offset;
            legY += offset;
            break;
          case 'topRight':
            legX -= offset;
            legY += offset;
            break;
          case 'bottomLeft':
            legX += offset;
            legY -= offset;
            break;
          case 'bottomRight':
            legX -= offset;
            legY -= offset;
            break;
        }

        leg.style.left = (legX - 4) + 'px'; 
        leg.style.top = (legY - 4) + 'px';
        stageDiv.appendChild(leg);
      }

      /**
       * Rysuje panel na głównej scenie + dodaje 4 nogi.
       */
      function drawPanelMain(x, y, w, h, panelClass) {
        const panel = document.createElement('div');
        panel.classList.add('panel', panelClass);
        panel.style.width = (w * scale) + 'px';
        panel.style.height = (h * scale) + 'px';
        panel.style.left = (x * scale) + 'px';
        panel.style.top = (y * scale) + 'px';
        panel.textContent = `${w}×${h} m`;
        stageDiv.appendChild(panel);

        addLegMain(x,       y,       'topLeft');
        addLegMain(x + w,   y,       'topRight');
        addLegMain(x,       y + h,   'bottomLeft');
        addLegMain(x + w,   y + h,   'bottomRight');
      }

      /**
       * Rysuje panel w dobudowanej części + dodaje 4 nogi.
       */
      function drawPanelAddon(x, y, w, h, panelClass) {
        const panel = document.createElement('div');
        panel.classList.add('panel', panelClass);
        panel.style.width = (w * scale) + 'px';
        panel.style.height = (h * scale) + 'px';
        panel.style.left = (x * scale) + 'px';
        panel.style.top = (y * scale) + 'px';
        panel.textContent = `${w}×${h} m`;
        stageDiv.appendChild(panel);

        addLegAddon(x,       y,       'topLeft');
        addLegAddon(x + w,   y,       'topRight');
        addLegAddon(x,       y + h,   'bottomLeft');
        addLegAddon(x + w,   y + h,   'bottomRight');
      }

      // --- Rysowanie głównych paneli ---
      let primaryCount = 0;
      for (let r = 0; r < primaryRows; r++) {
        for (let c = 0; c < primaryCols; c++) {
          const panelX = c * primaryPanelWidth;
          const panelY = r * primaryPanelHeight;
          drawPanelMain(panelX, panelY, primaryPanelWidth, primaryPanelHeight, 'primary');
          primaryCount++;
        }
      }

      // Obliczamy, ile miejsca (w metrach) zostało poza głównymi panelami
      const usedWidth = primaryCols * primaryPanelWidth;
      const usedHeight = primaryRows * primaryPanelHeight;
      const leftoverWidth = sceneWidth - usedWidth;
      const leftoverHeight = sceneHeight - usedHeight;

      let rotatedCount = 0;

      // --- Uzupełnienie prawego pasa (dla "wzdłuż") ---
      if (orientation === 'wzdluż' && leftoverWidth > 0) {
        const rightAvailableWidth = leftoverWidth;
        const rightAvailableHeight = usedHeight;
        const rightCols = Math.floor(rightAvailableWidth / rotatedPanelWidth);
        const rightRows = Math.floor(rightAvailableHeight / rotatedPanelHeight);
        
        for (let r = 0; r < rightRows; r++) {
          for (let c = 0; c < rightCols; c++) {
            const panelX = usedWidth + c * rotatedPanelWidth;
            const panelY = r * rotatedPanelHeight;
            drawPanelAddon(panelX, panelY, rotatedPanelWidth, rotatedPanelHeight, 'rotated');
            rotatedCount++;
          }
        }

        // Luka w prawym dolnym rogu
        const gapHeight = rightAvailableHeight - rightRows * rotatedPanelHeight;
        if (gapHeight > 0) {
          const gapCols = rightAvailableWidth;
          for (let row = 0; row < gapHeight; row++) {
            for (let col = 0; col < gapCols; col++) {
              const panelX = usedWidth + col;
              const panelY = rightRows * rotatedPanelHeight + row;
              drawPanelAddon(panelX, panelY, 1, 1, 'small');
            }
          }
        }
      }

      // --- Uzupełnienie dolnego pasa (dla "wpoprzek") ---
      if (orientation === 'wpoprzek' && leftoverHeight > 0) {
        const bottomAvailableWidth = sceneWidth;
        const bottomAvailableHeight = leftoverHeight;
        const bottomCols = Math.floor(bottomAvailableWidth / rotatedPanelWidth);
        const bottomRows = Math.floor(bottomAvailableHeight / rotatedPanelHeight);

        for (let row = 0; row < bottomRows; row++) {
          for (let col = 0; col < bottomCols; col++) {
            const xPos = col * rotatedPanelWidth;
            if (xPos >= usedWidth) continue;

            const panelX = xPos;
            const panelY = usedHeight + row * rotatedPanelHeight;
            drawPanelAddon(panelX, panelY, rotatedPanelWidth, rotatedPanelHeight, 'rotated');
            rotatedCount++;
          }
        }

        // Luka w prawym dolnym rogu
        const gapWidth = sceneWidth - bottomCols * rotatedPanelWidth;
        if (gapWidth > 0) {
          for (let row = 0; row < bottomAvailableHeight; row++) {
            for (let col = 0; col < gapWidth; col++) {
              const panelX = bottomCols * rotatedPanelWidth + col;
              const panelY = usedHeight + row;
              drawPanelAddon(panelX, panelY, 1, 1, 'small');
            }
          }
        }
      }

      // Liczba nóg:
      const totalLegs = usedCornersMain.size + usedCornersAddons.size;

      // Wyświetlamy podsumowanie
      const summaryDiv = document.getElementById('summary');
      summaryDiv.textContent = (
        `Podest główny: ${primaryCount} paneli.\n` +
        `Uzupełniające: ${rotatedCount} paneli.\n` +
        `\n` +
        `Liczba unikalnych nóg (w głównej scenie): ${usedCornersMain.size}\n` +
        `Liczba unikalnych nóg (w dobudowanych): ${usedCornersAddons.size}\n` +
        `---------------------------------\n` +
        `Łącznie: ${totalLegs} nóg.`
      );
    };
  </script>

  <!-- Test block: verifying that drawStage is accessible -->
  <script>
    window.addEventListener('DOMContentLoaded', () => {
      console.log("Test 1: Checking if drawStage is defined in global scope.");
      if (typeof window.drawStage === 'function') {
        console.log("Test 1 passed: drawStage is defined.");
      } else {
        console.error("Test 1 failed: drawStage is not defined.");
      }
    });
  </script>
</body>
</html>